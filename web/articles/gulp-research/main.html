<!DOCTYPE html>
<html>
<head lang="zh-cn">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Gulp - 龙则的博客站点</title>
    <link href="/src/css/all.css" rel="stylesheet"/>
</head>
<body>
<header class="page-header">
    <h1>
        <span class="main-title">龙则的个人站点</span>
        <span class="subtitle">记录我在北京的生活与感悟，记录在某大公司的技术(主要是前端)研究</span>
    </h1>
    <nav class="nav">
        <button class="icon-menu-button"></button>
        <menu>
            <a class="item">Home</a>
            <a class="item">前端技术</a>
            <a class="item">技术梳理</a>
            <a class="item">本站成书</a>
            <a class="item">本站 & 站主</a>
        </menu>
    </nav>
</header>
<div class="page-body">
    <div class="article-detail-container">
    <h1 id="gulp">Gulp</h1>
<blockquote>
<p>我也来学学这个新玩意。</p>
</blockquote>
<h2 id="-">环境</h2>
<p>全局安装(只有全局安装的包才可以直接使用命令行)：</p>
<pre><code>$ npm install --global gulp
</code></pre><p>然后添加文件 <code>gulpfile.js</code>，在此文件所在的文件夹下运行命令 <code>gulp</code>，截图如下：</p>
<p><img src="img/1.jpg" alt="image"> </p>
<p>局部安装</p>
<pre><code>$ npm install gulp
</code></pre><p>如果只局部安装，通过下面命令也可以运行，原理参见另一篇文章<a href="../mpm/main.html">npm</a>。</p>
<pre><code>./node_modules/gulp/bin/gulp.js
</code></pre><p>还需要安装各种插件，这样普通的合并压缩任务才能进行</p>
<pre><code>npm install gulp-minify-css gulp-uglify gulp-concat gulp-rename gulp-jshint --save-dev
</code></pre><h2 id="api">API</h2>
<p>只有四个方法，详细解释参见<a href="http://www.gulpjs.com.cn/docs/api/">gulp API</a>：</p>
<ul>
<li>src 获取要处理的文件</li>
<li>dest 定义处理后的输出路径</li>
<li>task 定义处理方式</li>
<li>watch 监听文件</li>
</ul>
<h2 id="-">说明</h2>
<p>gulpfile.js 文件中的default任务在没有参数的时候被调用，一般会在default中以 <code>gulp.start</code> 的方式调用全部任务。也可以在命令行单独执行某个任务，如 <code>gulp MinCSS</code>。</p>
<pre><code>// 任务入口
gulp.task(&#39;default&#39;, function() {
    console.log(&#39;default任务开始&#39;);
    gulp.start([&#39;MinCSS&#39;]);
});

// 合并压缩CSS
gulp.task(&#39;MinCSS&#39;, function () {
    // 处理任务的代码
});
</code></pre><p>gulp的任务都是异步执行的，如果一个任务依赖另一个，需要配置依赖。下面是官网上的例子：</p>
<pre><code>var gulp = require(&#39;gulp&#39;);

// 返回一个 callback，因此系统可以知道它什么时候完成
gulp.task(&#39;one&#39;, function(cb) {
    // 做一些事 -- 异步的或者其他的
    cb(err); // 如果 err 不是 null 或 undefined，则会停止执行，且注意，这样代表执行失败了
});

// 定义一个所依赖的 task 必须在这个 task 执行之前完成
gulp.task(&#39;two&#39;, [&#39;one&#39;], function() {
    // &#39;one&#39; 完成后
});

gulp.task(&#39;default&#39;, [&#39;one&#39;, &#39;two&#39;]);
</code></pre><h2 id="-">技巧 + 实例</h2>
<p>在 <a href="https://github.com/longze/cellar/tree/master/web/articles/gulp-research">github</a> 上可以找到相关Demo。</p>
<h3 id="css-">CSS压缩</h3>
<p><strong>纯css按文件顺序合并压缩</strong></p>
<pre><code>var gulp = require(&#39;gulp&#39;);
var minifycss = require(&#39;gulp-minify-css&#39;);
var concat = require(&#39;gulp-concat&#39;);
var rename = require(&#39;gulp-rename&#39;);

gulp.task(&#39;default&#39;, [&#39;MinCSS&#39;]);

// 合并压缩CSS-1
gulp.task(&#39;MinCSS&#39;, function () {
    var outPutFolder = &#39;asset/css&#39;;
    gulp.src(&#39;css-1/*.css&#39;)
        .pipe(concat(&#39;all.css&#39;))
        .pipe(gulp.dest(outPutFolder))
        .pipe(minifycss())
        .pipe(rename(&#39;all-min.css&#39;))
        .pipe(gulp.dest(outPutFolder));
});
</code></pre><p><strong>通过import文件合并压缩</strong></p>
<pre><code>@import url(a.css);
@import url(b.css);
</code></pre><p>一些项目会把所有的css通过一个import文件包含进去，方便页面引用和某些打包工具，一些老项目迁移gulp时需要一些技巧。    </p>
<pre><code>// 合并压缩CSS-2
gulp.task(&#39;MinCSS&#39;, function () {
    var outPutFolder = &#39;asset/css&#39;;
    gulp.src(&#39;css-2/import.css&#39;)
        .pipe(minifycss())
        .pipe(rename(&#39;all-min.css&#39;))
        .pipe(gulp.dest(outPutFolder));
});
</code></pre><p>这个方法只能得到合并压缩后的css，有一个额外的好处是可以控制css文件的合并顺序。如果需要合并不压缩的文件，通过文件排除技巧来实现。</p>
<pre><code>gulp.task(&#39;MinCSS&#39;, function () {
    var outPutFolder = &#39;asset/css&#39;;
    gulp.src([&#39;css-2/!(import)*.css&#39;])
        .pipe(concat(&#39;all.css&#39;))
        .pipe(gulp.dest(outPutFolder));
});
</code></pre><p><strong>移动图片</strong></p>
<h2 id="-">参考资料</h2>
<p><a href="http://www.gulpjs.com.cn/docs/api/">gulp API</a></p>

    </div>
    <div class="article-message-container"></div>
</div>
<footer class="page-footer"></footer>
</body>
</html>